# loop/cn site

Next.js app for the loop/cn docs + shadcn registry host.

## What this package hosts

- `registry.json` source manifest
- Built registry files under `public/r/*` (generated by `shadcn build`)
- Docs site at `/docs`
- Docs admin at `/docs/admin`

## Local commands

```bash
# dev server
pnpm dev

# registry + production build
pnpm build

# regenerate registry output only
pnpm registry:build
```

## Vercel deploy (local)

Set these env vars first:

- `VERCEL_TOKEN`
- `VERCEL_ORG_ID`
- `VERCEL_PROJECT_ID`

Then deploy:

```bash
# preview
pnpm deploy:vercel:preview

# production
pnpm deploy:vercel:prod
```

Both commands run the same build path as CI: `shadcn build` then `next build`.

## GitHub Actions deploy

Workflow file: `.github/workflows/vercel-site.yml`

- Pull requests: preview deploy
- Push to `main`: production deploy

Required repo secrets:

- `VERCEL_TOKEN`
- `VERCEL_ORG_ID`
- `VERCEL_PROJECT_ID`

## Updating registry URL after deploy

If production URL changes, sync `registry.json` quickly:

```bash
pnpm registry:url -- https://your-domain.com
pnpm registry:build
```

Optional namespace override:

```bash
REGISTRY_NAMESPACE=@loop-cn pnpm registry:url -- https://your-domain.com
```

## Docs admin env vars

```bash
DOCS_ADMIN_USERNAME=admin
DOCS_ADMIN_PASSWORD=change-me
DOCS_ADMIN_SECRET=replace-me-with-a-long-random-value
```
