package loop:ui@0.1.0;

use loop:fx@0.1.0/{node-id};

world ui {
  type length = variant { auto, px: f32, percent: f32 }
  type axis = enum { x, y }
  type align = enum { start, center, end, stretch }
  type justify = enum { start, center, end, between, around }
  type overflow-mode = enum { visible, hidden, scroll }

  type color = record { r: f32, g: f32, b: f32, a: f32 }
  type inset = record { top: f32, right: f32, bottom: f32, left: f32 }
  type radius = record { top-left: f32, top-right: f32, bottom-right: f32, bottom-left: f32 }

  type text-style = record {
    family: string,
    size: f32,
    weight: f32,
    color: color,
  }

  /// Declarative element tree inspired by usegpu-style layout primitives.
  type element = variant {
    block: record {
      key: option<string>,
      width: length,
      height: length,
      padding: inset,
      gap: f32,
      background: option<color>,
      children: list<element>,
    },
    inline: record {
      key: option<string>,
      children: list<element>,
    },
    flex: record {
      key: option<string>,
      axis: axis,
      align: align,
      justify: justify,
      gap: f32,
      children: list<element>,
    },
    absolute: record {
      key: option<string>,
      left: option<f32>,
      top: option<f32>,
      right: option<f32>,
      bottom: option<f32>,
      child: element,
    },
    overflow: record {
      key: option<string>,
      mode: overflow-mode,
      child: element,
    },
    rect: record {
      key: option<string>,
      width: length,
      height: length,
      background: option<color>,
      radius: option<radius>,
    },
    text: record {
      key: option<string>,
      content: string,
      style: text-style,
    },
    transform: record {
      key: option<string>,
      translate-x: f32,
      translate-y: f32,
      scale-x: f32,
      scale-y: f32,
      rotate-deg: f32,
      child: element,
    },
  }

  type view-id = u64

  export tree: interface {
    /// Mount a UI tree; returns a stable view handle. Designed to pair with loop:fx nodes.
    mount: func(root: element) -> view-id

    /// Replace the root element for the view (diffing is host-defined).
    update: func(view: view-id, root: element)

    /// Commit batched updates (no-op for hosts that eagerly apply).
    commit: func(view: view-id)

    /// Map a UI view to an fx node id, enabling reconciliation coupling.
    attach-fx-node: func(view: view-id, node: node-id)
  }
}
