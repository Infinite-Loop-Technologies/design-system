name: CI

on:
    pull_request:
    push:
        branches:
            - main

permissions:
    contents: read

jobs:
    checks:
        runs-on: ubuntu-latest

        steps:
            - name: Checkout
              uses: actions/checkout@v4
              with:
                  fetch-depth: 0

            - name: Setup moon + toolchain
              uses: moonrepo/setup-toolchain@v0

            - name: Install dependencies
              run: pnpm install --frozen-lockfile

            - name: Run affected checks (pull requests)
              if: github.event_name == 'pull_request'
              run: moon ci :typecheck :build :lint --base origin/main --head HEAD

            - name: Run full checks (main)
              if: github.event_name == 'push'
              run: moon run :typecheck :build :lint
